export function initializeMudExOneDriveFilePicker(t,i,r){return new n(t,i,r)}class n{elementRef;dotnet;options;accessToken=null;pickerInited=false;constructor(n,t,i){this.elementRef=n;this.dotnet=t;this.setOptions(i)}setOptions(n){this.options={...n,...n.jsOptions||{}};delete this.options.jsOptions;this.options.clientId&&this.loadApi()}loadApi(){const n=document.getElementById("onedrivejs");if(n)this.apiLoaded();else{const n=document.createElement("script");n.module=!0;n.id="onedrivejs";n.src="https://js.live.net/v7.2/OneDrive.js";n.onload=this.apiLoaded.bind(this);document.body.appendChild(n)}}apiLoaded(){this.pickerInited=!0;this.dotnet.invokeMethodAsync(this.options.onReadyCallback)}openPicker(){const n={clientId:this.options.clientId,action:"query",multiSelect:this.options.multiSelect||!1,advanced:{redirectUri:this.options.redirectUri||window.location.origin,accessToken:this.accessToken||undefined},success:n=>{this.accessToken=n.accessToken,this.apiEndpoint=n.apiEndpoint,this.processResult(n)},cancel:()=>{this.dotnet.invokeMethodAsync(this.options.onFilesSelectedCallback,[])},error:n=>{console.error(n)}};OneDrive.open(n)}async processResult(n){const t=[];for(const i of n.value)if(i.folder){const n=await this.getAllFilesInFolder(i.id);t.push(...n)}else{const n=await this.processFile(i);t.push(n)}this.dotnet.invokeMethodAsync(this.options.onFilesSelectedCallback,t)}async getFileDetails(n){const t=await fetch(`${this.apiEndpoint}me/drive/items/${n}`,{headers:new Headers({Authorization:`Bearer ${this.accessToken}`})});return t.json()}async processFile(n){const i=n.id,t=await this.getFileDetails(i),r=t.name,f=r.split(".").pop();let u={id:i,size:t.size,accessToken:this.accessToken,fileName:r,extension:f,contentType:t.file.mimeType,webViewLink:t.webUrl,webContentLink:null,path:""};if(this.options.autoLoadFileDataBytes){const n=await fetch(t["@microsoft.graph.downloadUrl"],{headers:new Headers({Authorization:`Bearer ${this.accessToken}`})}),i=await n.blob();u.data=await MudExUriHelper.blobToByteArray(i)}return u}async getAllFilesInFolder(){return[]}async getFilePath(){return""}dispose(){}}window.MudExOneDriveFilePicker=n;