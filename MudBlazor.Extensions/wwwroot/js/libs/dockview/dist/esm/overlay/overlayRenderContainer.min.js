/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/dockview-core@4.7.1/dist/esm/overlay/overlayRenderContainer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{DragAndDropObserver}from"../dnd/dnd";import{getDomNodePagePosition,toggleClass}from"../dom";import{CompositeDisposable,Disposable,MutableDisposable}from"../lifecycle";class PositionCache{constructor(){this.cache=new Map,this.currentFrameId=0,this.rafId=null}getPosition(e){const t=this.cache.get(e);if(t&&t.frameId===this.currentFrameId)return t.rect;this.scheduleFrameUpdate();const i=getDomNodePagePosition(e);return this.cache.set(e,{rect:i,frameId:this.currentFrameId}),i}invalidate(){this.currentFrameId++}scheduleFrameUpdate(){this.rafId||(this.rafId=requestAnimationFrame((()=>{this.currentFrameId++,this.rafId=null})))}}function createFocusableElement(){const e=document.createElement("div");return e.tabIndex=-1,e}export class OverlayRenderContainer extends CompositeDisposable{constructor(e,t){super(),this.element=e,this.accessor=t,this.map={},this._disposed=!1,this.positionCache=new PositionCache,this.pendingUpdates=new Set,this.addDisposables(Disposable.from((()=>{for(const e of Object.values(this.map))e.disposable.dispose(),e.destroy.dispose();this._disposed=!0})))}updateAllPositions(){if(!this._disposed){this.positionCache.invalidate();for(const e of Object.values(this.map))e.panel.api.isVisible&&e.resize&&e.resize()}}detatch(e){if(this.map[e.api.id]){const{disposable:t,destroy:i}=this.map[e.api.id];return t.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1}attach(e){const{panel:t,referenceContainer:i}=e;if(!this.map[t.api.id]){const e=createFocusableElement();e.className="dv-render-overlay",this.map[t.api.id]={panel:t,disposable:Disposable.NONE,destroy:Disposable.NONE,element:e}}const s=this.map[t.api.id].element;t.view.content.element.parentElement!==s&&s.appendChild(t.view.content.element),s.parentElement!==this.element&&this.element.appendChild(s);const a=()=>{const e=t.api.id;this.pendingUpdates.has(e)||(this.pendingUpdates.add(e),requestAnimationFrame((()=>{if(this.pendingUpdates.delete(e),this.isDisposed||!this.map[e])return;const a=this.positionCache.getPosition(i.element),o=this.positionCache.getPosition(this.element),n=a.left-o.left,r=a.top-o.top,d=a.width,p=a.height;s.style.left=`${n}px`,s.style.top=`${r}px`,s.style.width=`${d}px`,s.style.height=`${p}px`,toggleClass(s,"dv-render-overlay-float","floating"===t.group.api.location.type)})))},o=()=>{t.api.isVisible&&(this.positionCache.invalidate(),a()),s.style.display=t.api.isVisible?"":"none"},n=new MutableDisposable,r=()=>{"floating"===t.api.location.type?queueMicrotask((()=>{const e=this.accessor.floatingGroups.find((e=>e.group===t.api.group));if(!e)return;const i=e.overlay.element,a=()=>{const e=Number(i.getAttribute("aria-level"));s.style.zIndex=`calc(var(--dv-overlay-z-index, 999) + ${2*e+1})`},o=new MutationObserver((()=>{a()}));n.value=Disposable.from((()=>o.disconnect())),o.observe(i,{attributeFilter:["aria-level"],attributes:!0}),a()})):s.style.zIndex=""},d=new CompositeDisposable(n,new DragAndDropObserver(s,{onDragEnd:e=>{i.dropTarget.dnd.onDragEnd(e)},onDragEnter:e=>{i.dropTarget.dnd.onDragEnter(e)},onDragLeave:e=>{i.dropTarget.dnd.onDragLeave(e)},onDrop:e=>{i.dropTarget.dnd.onDrop(e)},onDragOver:e=>{i.dropTarget.dnd.onDragOver(e)}}),t.api.onDidVisibilityChange((()=>{o()})),t.api.onDidDimensionsChange((()=>{t.api.isVisible&&a()})),t.api.onDidLocationChange((()=>{r()})));return this.map[t.api.id].destroy=Disposable.from((()=>{var e;t.view.content.element.parentElement===s&&s.removeChild(t.view.content.element),null===(e=s.parentElement)||void 0===e||e.removeChild(s)})),r(),queueMicrotask((()=>{this.isDisposed||o()})),this.map[t.api.id].disposable.dispose(),this.map[t.api.id].disposable=d,this.map[t.api.id].resize=a,s}}
//# sourceMappingURL=/sm/dd555a0dd36709c59f5915eae79aef580cb72708eb2a6b81a096f1549ae572be.map