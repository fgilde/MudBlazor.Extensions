/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/dockview-core@4.7.1/dist/cjs/gridview/gridview.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __read=this&&this.__read||function(e,i){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var o,r,n=t.call(e),a=[];try{for(;(void 0===i||i-- >0)&&!(o=n.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}return a},__spreadArray=this&&this.__spreadArray||function(e,i,t){if(t||2===arguments.length)for(var o,r=0,n=i.length;r<n;r++)!o&&r in i||(o||(o=Array.prototype.slice.call(i,0,r)),o[r]=i[r]);return e.concat(o||Array.prototype.slice.call(i))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Gridview=exports.isGridBranchNode=exports.orthogonal=exports.getLocationOrientation=exports.getDirectionOrientation=exports.getRelativeLocation=exports.getGridLocation=exports.indexInParent=void 0;var splitview_1=require("../splitview/splitview"),array_1=require("../array"),leafNode_1=require("./leafNode"),branchNode_1=require("./branchNode"),events_1=require("../events"),lifecycle_1=require("../lifecycle");function findLeaf(e,i){if(e instanceof leafNode_1.LeafNode)return e;if(e instanceof branchNode_1.BranchNode)return findLeaf(e.children[i?e.children.length-1:0],i);throw new Error("invalid node")}function cloneNode(e,i,t){if(e instanceof branchNode_1.BranchNode){for(var o=new branchNode_1.BranchNode(e.orientation,e.proportionalLayout,e.styles,i,t,e.disabled,e.margin),r=e.children.length-1;r>=0;r--){var n=e.children[r];o.addChild(cloneNode(n,n.size,n.orthogonalSize),n.size,0,!0)}return o}return new leafNode_1.LeafNode(e.view,e.orientation,t)}function flipNode(e,i,t){if(e instanceof branchNode_1.BranchNode){for(var o=new branchNode_1.BranchNode((0,exports.orthogonal)(e.orientation),e.proportionalLayout,e.styles,i,t,e.disabled,e.margin),r=0,n=e.children.length-1;n>=0;n--){var a=e.children[n],d=a instanceof branchNode_1.BranchNode?a.orthogonalSize:a.size,s=0===e.size?0:Math.round(i*d/e.size);r+=s,0===n&&(s+=i-r),o.addChild(flipNode(a,t,s),s,0,!0)}return o}return new leafNode_1.LeafNode(e.view,(0,exports.orthogonal)(e.orientation),t)}function indexInParent(e){var i=e.parentElement;if(!i)throw new Error("Invalid grid element");for(var t=i.firstElementChild,o=0;t!==e&&t!==i.lastElementChild&&t;)t=t.nextElementSibling,o++;return o}function getGridLocation(e){var i=e.parentElement;if(!i)throw new Error("Invalid grid element");if(/\bdv-grid-view\b/.test(i.className))return[];var t=indexInParent(i),o=i.parentElement.parentElement.parentElement;return __spreadArray(__spreadArray([],__read(getGridLocation(o)),!1),[t],!1)}function getRelativeLocation(e,i,t){if(getLocationOrientation(e,i)===getDirectionOrientation(t)){var o=__read((0,array_1.tail)(i),2),r=o[0],n=o[1];return"right"!==t&&"bottom"!==t||(n+=1),__spreadArray(__spreadArray([],__read(r),!1),[n],!1)}n="right"===t||"bottom"===t?1:0;return __spreadArray(__spreadArray([],__read(i),!1),[n],!1)}function getDirectionOrientation(e){return"top"===e||"bottom"===e?splitview_1.Orientation.VERTICAL:splitview_1.Orientation.HORIZONTAL}function getLocationOrientation(e,i){return i.length%2==0?(0,exports.orthogonal)(e):e}exports.indexInParent=indexInParent,exports.getGridLocation=getGridLocation,exports.getRelativeLocation=getRelativeLocation,exports.getDirectionOrientation=getDirectionOrientation,exports.getLocationOrientation=getLocationOrientation;var orthogonal=function(e){return e===splitview_1.Orientation.HORIZONTAL?splitview_1.Orientation.VERTICAL:splitview_1.Orientation.HORIZONTAL};function isGridBranchNode(e){return!!e.children}exports.orthogonal=orthogonal,exports.isGridBranchNode=isGridBranchNode;var serializeBranchNode=function(e,i){var t=i===splitview_1.Orientation.VERTICAL?e.box.width:e.box.height;return isGridBranchNode(e)?{type:"branch",data:e.children.map((function(e){return serializeBranchNode(e,(0,exports.orthogonal)(i))})),size:t}:"number"==typeof e.cachedVisibleSize?{type:"leaf",data:e.view.toJSON(),size:e.cachedVisibleSize,visible:!1}:{type:"leaf",data:e.view.toJSON(),size:t}},Gridview=function(){function e(e,i,t,o,r){this.proportionalLayout=e,this.styles=i,this._locked=!1,this._margin=0,this._maximizedNode=void 0,this.disposable=new lifecycle_1.MutableDisposable,this._onDidChange=new events_1.Emitter,this.onDidChange=this._onDidChange.event,this._onDidViewVisibilityChange=new events_1.Emitter,this.onDidViewVisibilityChange=this._onDidViewVisibilityChange.event,this._onDidMaximizedNodeChange=new events_1.Emitter,this.onDidMaximizedNodeChange=this._onDidMaximizedNodeChange.event,this.element=document.createElement("div"),this.element.className="dv-grid-view",this._locked=null!=o&&o,this._margin=null!=r?r:0,this.root=new branchNode_1.BranchNode(t,e,i,0,0,this.locked,this.margin)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._root?this._root.children.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orientation",{get:function(){return this.root.orientation},set:function(e){if(this.root.orientation!==e){var i=this.root,t=i.size,o=i.orthogonalSize;this.root=flipNode(this.root,o,t),this.root.layout(t,o)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.root.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.root.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumWidth",{get:function(){return this.root.minimumWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumHeight",{get:function(){return this.root.minimumHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximumWidth",{get:function(){return this.root.maximumHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximumHeight",{get:function(){return this.root.maximumHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"locked",{get:function(){return this._locked},set:function(e){this._locked=e;for(var i=[this.root];i.length>0;){var t=i.pop();t instanceof branchNode_1.BranchNode&&(t.disabled=e,i.push.apply(i,__spreadArray([],__read(t.children),!1)))}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin},set:function(e){this._margin=e,this.root.margin=e},enumerable:!1,configurable:!0}),e.prototype.maximizedView=function(){var e;return null===(e=this._maximizedNode)||void 0===e?void 0:e.leaf.view},e.prototype.hasMaximizedView=function(){return void 0!==this._maximizedNode},e.prototype.maximizeView=function(e){var i,t=getGridLocation(e.element),o=__read(this.getNode(t),2),r=(o[0],o[1]);if(r instanceof leafNode_1.LeafNode&&(null===(i=this._maximizedNode)||void 0===i?void 0:i.leaf)!==r){this.hasMaximizedView()&&this.exitMaximizedView(),serializeBranchNode(this.getView(),this.orientation);var n=[];!function e(i,t){for(var o=0;o<i.children.length;o++){var r=i.children[o];r instanceof leafNode_1.LeafNode?r!==t&&(i.isChildVisible(o)?i.setChildVisible(o,!1):n.push(r)):e(r,t)}}(this.root,r),this._maximizedNode={leaf:r,hiddenOnMaximize:n},this._onDidMaximizedNodeChange.fire({view:r.view,isMaximized:!0})}},e.prototype.exitMaximizedView=function(){if(this._maximizedNode){var e=this._maximizedNode.hiddenOnMaximize;!function i(t){for(var o=t.children.length-1;o>=0;o--){var r=t.children[o];r instanceof leafNode_1.LeafNode?e.includes(r)||t.setChildVisible(o,!0):i(r)}}(this.root);var i=this._maximizedNode.leaf;this._maximizedNode=void 0,this._onDidMaximizedNodeChange.fire({view:i.view,isMaximized:!1})}},e.prototype.serialize=function(){var e,i=this.maximizedView();i&&(e=getGridLocation(i.element)),this.hasMaximizedView()&&this.exitMaximizedView();var t={root:serializeBranchNode(this.getView(),this.orientation),width:this.width,height:this.height,orientation:this.orientation};return e&&(t.maximizedNode={location:e}),i&&this.maximizeView(i),t},e.prototype.dispose=function(){this.disposable.dispose(),this._onDidChange.dispose(),this._onDidMaximizedNodeChange.dispose(),this._onDidViewVisibilityChange.dispose(),this.root.dispose(),this._maximizedNode=void 0,this.element.remove()},e.prototype.clear=function(){var e=this.root.orientation;this.root=new branchNode_1.BranchNode(e,this.proportionalLayout,this.styles,this.root.size,this.root.orthogonalSize,this.locked,this.margin)},e.prototype.deserialize=function(e,i){var t=e.orientation,o=t===splitview_1.Orientation.VERTICAL?e.height:e.width;if(this._deserialize(e.root,t,i,o),this.layout(e.width,e.height),e.maximizedNode){var r=e.maximizedNode.location,n=__read(this.getNode(r),2),a=(n[0],n[1]);if(!(a instanceof leafNode_1.LeafNode))return;this.maximizeView(a.view)}},e.prototype._deserialize=function(e,i,t,o){this.root=this._deserializeNode(e,i,t,o)},e.prototype._deserializeNode=function(e,i,t,o){var r,n,a=this;if("branch"===e.type){var d=e.data.map((function(o){return{node:a._deserializeNode(o,(0,exports.orthogonal)(i),t,e.size),visible:o.visible}}));n=new branchNode_1.BranchNode(i,this.proportionalLayout,this.styles,e.size,o,this.locked,this.margin,d)}else{var s=t.fromJSON(e);"boolean"==typeof e.visible&&(null===(r=s.setVisible)||void 0===r||r.call(s,e.visible)),n=new leafNode_1.LeafNode(s,i,o,e.size)}return n},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},set:function(e){var i=this,t=this._root;t&&(t.dispose(),this._maximizedNode=void 0,this.element.removeChild(t.element)),this._root=e,this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange((function(e){i._onDidChange.fire(e)}))},enumerable:!1,configurable:!0}),e.prototype.normalize=function(){var e=this;if(this._root&&1===this._root.children.length){var i=this.root,t=i.children[0];if(!(t instanceof leafNode_1.LeafNode)){i.element.remove();var o=i.removeChild(0);i.dispose(),o.dispose(),this._root=cloneNode(t,t.size,t.orthogonalSize),this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange((function(i){e._onDidChange.fire(i)}))}}},e.prototype.insertOrthogonalSplitviewAtRoot=function(){var e=this;if(this._root){var i=this.root;if(i.element.remove(),this._root=new branchNode_1.BranchNode((0,exports.orthogonal)(i.orientation),this.proportionalLayout,this.styles,this.root.orthogonalSize,this.root.size,this.locked,this.margin),0===i.children.length);else if(1===i.children.length){var t=i.children[0];i.removeChild(0).dispose(),i.dispose(),this._root.addChild(flipNode(t,t.orthogonalSize,t.size),splitview_1.Sizing.Distribute,0)}else this._root.addChild(i,splitview_1.Sizing.Distribute,0);this.element.appendChild(this._root.element),this.disposable.value=this._root.onDidChange((function(i){e._onDidChange.fire(i)}))}},e.prototype.next=function(e){return this.progmaticSelect(e)},e.prototype.previous=function(e){return this.progmaticSelect(e,!0)},e.prototype.getView=function(e){var i=e?this.getNode(e)[1]:this.root;return this._getViews(i,this.orientation)},e.prototype._getViews=function(e,i,t){var o={height:e.height,width:e.width};if(e instanceof leafNode_1.LeafNode)return{box:o,view:e.view,cachedVisibleSize:t};for(var r=[],n=0;n<e.children.length;n++){var a=e.children[n],d=e.getChildCachedVisibleSize(n);r.push(this._getViews(a,(0,exports.orthogonal)(i),d))}return{box:o,children:r}},e.prototype.progmaticSelect=function(e,i){void 0===i&&(i=!1);var t=__read(this.getNode(e),2),o=t[0];if(!(t[1]instanceof leafNode_1.LeafNode))throw new Error("invalid location");for(var r=o.length-1;r>-1;r--){var n=o[r],a=e[r]||0;if(i?a-1>-1:a+1<n.children.length)return findLeaf(n.children[i?a-1:a+1],i)}return findLeaf(this.root,i)},e.prototype.isViewVisible=function(e){var i=__read((0,array_1.tail)(e),2),t=i[0],o=i[1],r=__read(this.getNode(t),2)[1];if(!(r instanceof branchNode_1.BranchNode))throw new Error("Invalid from location");return r.isChildVisible(o)},e.prototype.setViewVisible=function(e,i){this.hasMaximizedView()&&this.exitMaximizedView();var t=__read((0,array_1.tail)(e),2),o=t[0],r=t[1],n=__read(this.getNode(o),2)[1];if(!(n instanceof branchNode_1.BranchNode))throw new Error("Invalid from location");this._onDidViewVisibilityChange.fire(),n.setChildVisible(r,i)},e.prototype.moveView=function(e,i,t){this.hasMaximizedView()&&this.exitMaximizedView();var o=__read(this.getNode(e),2)[1];if(!(o instanceof branchNode_1.BranchNode))throw new Error("Invalid location");o.moveChild(i,t)},e.prototype.addView=function(e,i,t){this.hasMaximizedView()&&this.exitMaximizedView();var o=__read((0,array_1.tail)(t),2),r=o[0],n=o[1],a=__read(this.getNode(r),2),d=a[0],s=a[1];if(s instanceof branchNode_1.BranchNode){var h=new leafNode_1.LeafNode(e,(0,exports.orthogonal)(s.orientation),s.orthogonalSize);s.addChild(h,i,n)}else{var l=__read(__spreadArray([],__read(d),!1).reverse()),c=l[0],f=(l.slice(1),__read(__spreadArray([],__read(r),!1).reverse())),p=f[0],_=(f.slice(1),0),u=c.getChildCachedVisibleSize(p);"number"==typeof u&&(_=splitview_1.Sizing.Invisible(u)),c.removeChild(p).dispose();var v=new branchNode_1.BranchNode(s.orientation,this.proportionalLayout,this.styles,s.size,s.orthogonalSize,this.locked,this.margin);c.addChild(v,s.size,p);var m=new leafNode_1.LeafNode(s.view,c.orientation,s.size);v.addChild(m,_,0),"number"!=typeof i&&"split"===i.type&&(i={type:"split",index:0});h=new leafNode_1.LeafNode(e,c.orientation,s.size);v.addChild(h,i,n)}},e.prototype.remove=function(e,i){var t=getGridLocation(e.element);return this.removeView(t,i)},e.prototype.removeView=function(e,i){this.hasMaximizedView()&&this.exitMaximizedView();var t=__read((0,array_1.tail)(e),2),o=t[0],r=t[1],n=__read(this.getNode(o),2),a=n[0],d=n[1];if(!(d instanceof branchNode_1.BranchNode))throw new Error("Invalid location");var s=d.children[r];if(!(s instanceof leafNode_1.LeafNode))throw new Error("Invalid location");if(d.removeChild(r,i),s.dispose(),1!==d.children.length)return s.view;var h=d.children[0];if(0===a.length)return h instanceof leafNode_1.LeafNode||(d.removeChild(0,i),this.root=h),s.view;var l=__read(__spreadArray([],__read(a),!1).reverse()),c=l[0],f=(l.slice(1),__read(__spreadArray([],__read(o),!1).reverse())),p=f[0],_=(f.slice(1),d.isChildVisible(0));d.removeChild(0,i);var u=c.children.map((function(e,i){return c.getChildSize(i)}));if(c.removeChild(p,i).dispose(),h instanceof branchNode_1.BranchNode){u.splice.apply(u,__spreadArray([p,1],__read(h.children.map((function(e){return e.size}))),!1));for(var v=0;v<h.children.length;v++){var m=h.children[v];c.addChild(m,m.size,p+v)}for(;h.children.length>0;)h.removeChild(0)}else{var g=new leafNode_1.LeafNode(h.view,(0,exports.orthogonal)(h.orientation),h.size),N=_?h.orthogonalSize:splitview_1.Sizing.Invisible(h.orthogonalSize);c.addChild(g,N,p)}h.dispose();for(v=0;v<u.length;v++)c.resizeChild(v,u[v]);return s.view},e.prototype.layout=function(e,i){var t=__read(this.root.orientation===splitview_1.Orientation.HORIZONTAL?[i,e]:[e,i],2),o=t[0],r=t[1];this.root.layout(o,r)},e.prototype.getNode=function(e,i,t){if(void 0===i&&(i=this.root),void 0===t&&(t=[]),0===e.length)return[t,i];if(!(i instanceof branchNode_1.BranchNode))throw new Error("Invalid location");var o=__read(e),r=o[0],n=o.slice(1);if(r<0||r>=i.children.length)throw new Error("Invalid location");var a=i.children[r];return t.push(i),this.getNode(n,a,t)},e}();exports.Gridview=Gridview;
//# sourceMappingURL=/sm/4a6c1e77b4a9827ad3d24580aebc8aae0b01c72137e4cce1daab6b0bdbfb4eaa.map