/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/dockview-core@4.7.1/dist/cjs/overlay/overlayRenderContainer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.OverlayRenderContainer=void 0;var dnd_1=require("../dnd/dnd"),dom_1=require("../dom"),lifecycle_1=require("../lifecycle"),PositionCache=function(){function e(){this.cache=new Map,this.currentFrameId=0,this.rafId=null}return e.prototype.getPosition=function(e){var t=this.cache.get(e);if(t&&t.frameId===this.currentFrameId)return t.rect;this.scheduleFrameUpdate();var n=(0,dom_1.getDomNodePagePosition)(e);return this.cache.set(e,{rect:n,frameId:this.currentFrameId}),n},e.prototype.invalidate=function(){this.currentFrameId++},e.prototype.scheduleFrameUpdate=function(){var e=this;this.rafId||(this.rafId=requestAnimationFrame((function(){e.currentFrameId++,e.rafId=null})))},e}();function createFocusableElement(){var e=document.createElement("div");return e.tabIndex=-1,e}var OverlayRenderContainer=function(e){function t(t,n){var i=e.call(this)||this;return i.element=t,i.accessor=n,i.map={},i._disposed=!1,i.positionCache=new PositionCache,i.pendingUpdates=new Set,i.addDisposables(lifecycle_1.Disposable.from((function(){var e,t;try{for(var n=__values(Object.values(i.map)),r=n.next();!r.done;r=n.next()){var o=r.value;o.disposable.dispose(),o.destroy.dispose()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i._disposed=!0}))),i}return __extends(t,e),t.prototype.updateAllPositions=function(){var e,t;if(!this._disposed){this.positionCache.invalidate();try{for(var n=__values(Object.values(this.map)),i=n.next();!i.done;i=n.next()){var r=i.value;r.panel.api.isVisible&&r.resize&&r.resize()}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}},t.prototype.detatch=function(e){if(this.map[e.api.id]){var t=this.map[e.api.id],n=t.disposable,i=t.destroy;return n.dispose(),i.dispose(),delete this.map[e.api.id],!0}return!1},t.prototype.attach=function(e){var t=this,n=e.panel,i=e.referenceContainer;if(!this.map[n.api.id]){var r=createFocusableElement();r.className="dv-render-overlay",this.map[n.api.id]={panel:n,disposable:lifecycle_1.Disposable.NONE,destroy:lifecycle_1.Disposable.NONE,element:r}}var o=this.map[n.api.id].element;n.view.content.element.parentElement!==o&&o.appendChild(n.view.content.element),o.parentElement!==this.element&&this.element.appendChild(o);var a=function(){var e=n.api.id;t.pendingUpdates.has(e)||(t.pendingUpdates.add(e),requestAnimationFrame((function(){if(t.pendingUpdates.delete(e),!t.isDisposed&&t.map[e]){var r=t.positionCache.getPosition(i.element),a=t.positionCache.getPosition(t.element),s=r.left-a.left,l=r.top-a.top,c=r.width,p=r.height;o.style.left="".concat(s,"px"),o.style.top="".concat(l,"px"),o.style.width="".concat(c,"px"),o.style.height="".concat(p,"px"),(0,dom_1.toggleClass)(o,"dv-render-overlay-float","floating"===n.group.api.location.type)}})))},s=function(){n.api.isVisible&&(t.positionCache.invalidate(),a()),o.style.display=n.api.isVisible?"":"none"},l=new lifecycle_1.MutableDisposable,c=function(){"floating"===n.api.location.type?queueMicrotask((function(){var e=t.accessor.floatingGroups.find((function(e){return e.group===n.api.group}));if(e){var i=e.overlay.element,r=function(){var e=Number(i.getAttribute("aria-level"));o.style.zIndex="calc(var(--dv-overlay-z-index, 999) + ".concat(2*e+1,")")},a=new MutationObserver((function(){r()}));l.value=lifecycle_1.Disposable.from((function(){return a.disconnect()})),a.observe(i,{attributeFilter:["aria-level"],attributes:!0}),r()}})):o.style.zIndex=""},p=new lifecycle_1.CompositeDisposable(l,new dnd_1.DragAndDropObserver(o,{onDragEnd:function(e){i.dropTarget.dnd.onDragEnd(e)},onDragEnter:function(e){i.dropTarget.dnd.onDragEnter(e)},onDragLeave:function(e){i.dropTarget.dnd.onDragLeave(e)},onDrop:function(e){i.dropTarget.dnd.onDrop(e)},onDragOver:function(e){i.dropTarget.dnd.onDragOver(e)}}),n.api.onDidVisibilityChange((function(){s()})),n.api.onDidDimensionsChange((function(){n.api.isVisible&&a()})),n.api.onDidLocationChange((function(){c()})));return this.map[n.api.id].destroy=lifecycle_1.Disposable.from((function(){var e;n.view.content.element.parentElement===o&&o.removeChild(n.view.content.element),null===(e=o.parentElement)||void 0===e||e.removeChild(o)})),c(),queueMicrotask((function(){t.isDisposed||s()})),this.map[n.api.id].disposable.dispose(),this.map[n.api.id].disposable=p,this.map[n.api.id].resize=a,o},t}(lifecycle_1.CompositeDisposable);exports.OverlayRenderContainer=OverlayRenderContainer;
//# sourceMappingURL=/sm/69192b7c65eb4dae76661b48cd2c8eeb46638798597d617950f21ff96c240422.map