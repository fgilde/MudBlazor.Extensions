/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/dockview-core@4.7.1/dist/cjs/dockview/dockviewComponent.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var e=function(o,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])},e(o,i)};return function(o,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=o}e(o,i),o.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var o,i=1,t=arguments.length;i<t;i++)for(var n in o=arguments[i])Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);return e},__assign.apply(this,arguments)},__read=this&&this.__read||function(e,o){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var t,n,r=i.call(e),a=[];try{for(;(void 0===o||o-- >0)&&!(t=r.next()).done;)a.push(t.value)}catch(e){n={error:e}}finally{try{t&&!t.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}return a},__spreadArray=this&&this.__spreadArray||function(e,o,i){if(i||2===arguments.length)for(var t,n=0,r=o.length;n<r;n++)!t&&n in o||(t||(t=Array.prototype.slice.call(o,0,n)),t[n]=o[n]);return e.concat(t||Array.prototype.slice.call(o))},__values=this&&this.__values||function(e){var o="function"==typeof Symbol&&Symbol.iterator,i=o&&e[o],t=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DockviewComponent=void 0;var gridview_1=require("../gridview/gridview"),droptarget_1=require("../dnd/droptarget"),array_1=require("../array"),dockviewPanel_1=require("./dockviewPanel"),lifecycle_1=require("../lifecycle"),events_1=require("../events"),watermark_1=require("./components/watermark/watermark"),math_1=require("../math"),deserializer_1=require("./deserializer"),options_1=require("./options"),baseComponentGridview_1=require("../gridview/baseComponentGridview"),component_api_1=require("../api/component.api"),splitview_1=require("../splitview/splitview"),dockviewGroupPanelModel_1=require("./dockviewGroupPanelModel"),events_2=require("./events"),dockviewGroupPanel_1=require("./dockviewGroupPanel"),dockviewPanelModel_1=require("./dockviewPanelModel"),dataTransfer_1=require("../dnd/dataTransfer"),overlay_1=require("../overlay/overlay"),dom_1=require("../dom"),dockviewFloatingGroupPanel_1=require("./dockviewFloatingGroupPanel"),constants_1=require("../constants"),overlayRenderContainer_1=require("../overlay/overlayRenderContainer"),popoutWindow_1=require("../popoutWindow"),strictEventsSequencing_1=require("./strictEventsSequencing"),popupService_1=require("./components/popupService"),dropTargetAnchorContainer_1=require("../dnd/dropTargetAnchorContainer"),theme_1=require("./theme"),DEFAULT_ROOT_OVERLAY_MODEL={activationSize:{type:"pixels",value:10},size:{type:"pixels",value:20}};function moveGroupWithoutDestroying(e){var o=e.from.activePanel;__spreadArray([],__read(e.from.panels),!1).map((function(o){var i=e.from.model.removePanel(o);return e.from.model.renderContainer.detatch(o),i})).forEach((function(i){e.to.model.openPanel(i,{skipSetActive:o!==i,skipSetGroupActive:!0})}))}var DockviewComponent=function(e){function o(o,i){var t,n,r,a=e.call(this,o,{proportionalLayout:!0,orientation:splitview_1.Orientation.HORIZONTAL,styles:i.hideBorders?{separatorBorder:"transparent"}:void 0,disableAutoResizing:i.disableAutoResizing,locked:i.locked,margin:null!==(n=null===(t=i.theme)||void 0===t?void 0:t.gap)&&void 0!==n?n:0,className:i.className})||this;return a.nextGroupId=(0,math_1.sequentialNumberGenerator)(),a._deserializer=new deserializer_1.DefaultDockviewDeserialzier(a),a._watermark=null,a._onWillDragPanel=new events_1.Emitter,a.onWillDragPanel=a._onWillDragPanel.event,a._onWillDragGroup=new events_1.Emitter,a.onWillDragGroup=a._onWillDragGroup.event,a._onDidDrop=new events_1.Emitter,a.onDidDrop=a._onDidDrop.event,a._onWillDrop=new events_1.Emitter,a.onWillDrop=a._onWillDrop.event,a._onWillShowOverlay=new events_1.Emitter,a.onWillShowOverlay=a._onWillShowOverlay.event,a._onUnhandledDragOverEvent=new events_1.Emitter,a.onUnhandledDragOverEvent=a._onUnhandledDragOverEvent.event,a._onDidRemovePanel=new events_1.Emitter,a.onDidRemovePanel=a._onDidRemovePanel.event,a._onDidAddPanel=new events_1.Emitter,a.onDidAddPanel=a._onDidAddPanel.event,a._onDidPopoutGroupSizeChange=new events_1.Emitter,a.onDidPopoutGroupSizeChange=a._onDidPopoutGroupSizeChange.event,a._onDidPopoutGroupPositionChange=new events_1.Emitter,a.onDidPopoutGroupPositionChange=a._onDidPopoutGroupPositionChange.event,a._onDidOpenPopoutWindowFail=new events_1.Emitter,a.onDidOpenPopoutWindowFail=a._onDidOpenPopoutWindowFail.event,a._onDidLayoutFromJSON=new events_1.Emitter,a.onDidLayoutFromJSON=a._onDidLayoutFromJSON.event,a._onDidActivePanelChange=new events_1.Emitter({replay:!0}),a.onDidActivePanelChange=a._onDidActivePanelChange.event,a._onDidMovePanel=new events_1.Emitter,a.onDidMovePanel=a._onDidMovePanel.event,a._onDidMaximizedGroupChange=new events_1.Emitter,a.onDidMaximizedGroupChange=a._onDidMaximizedGroupChange.event,a._floatingGroups=[],a._popoutGroups=[],a._popoutRestorationPromise=Promise.resolve(),a._onDidRemoveGroup=new events_1.Emitter,a.onDidRemoveGroup=a._onDidRemoveGroup.event,a._onDidAddGroup=new events_1.Emitter,a.onDidAddGroup=a._onDidAddGroup.event,a._onDidOptionsChange=new events_1.Emitter,a.onDidOptionsChange=a._onDidOptionsChange.event,a._onDidActiveGroupChange=new events_1.Emitter,a.onDidActiveGroupChange=a._onDidActiveGroupChange.event,a._moving=!1,a._options=i,a.popupService=new popupService_1.PopupService(a.element),a._themeClassnames=new dom_1.Classnames(a.element),a._api=new component_api_1.DockviewApi(a),a.rootDropTargetContainer=new dropTargetAnchorContainer_1.DropTargetAnchorContainer(a.element,{disabled:!0}),a.overlayRenderContainer=new overlayRenderContainer_1.OverlayRenderContainer(a.gridview.element,a),a._rootDropTarget=new droptarget_1.Droptarget(a.element,{className:"dv-drop-target-edge",canDisplayOverlay:function(e,o){var i=(0,dataTransfer_1.getPanelData)();if(i)return i.viewId===a.id&&("center"!==o||0===a.gridview.length);if("center"===o&&0!==a.gridview.length)return!1;var t=new options_1.DockviewUnhandledDragOverEvent(e,"edge",o,dataTransfer_1.getPanelData);return a._onUnhandledDragOverEvent.fire(t),t.isAccepted},acceptedTargetZones:["top","bottom","left","right","center"],overlayModel:null!==(r=i.rootOverlayModel)&&void 0!==r?r:DEFAULT_ROOT_OVERLAY_MODEL,getOverrideTarget:function(){var e;return null===(e=a.rootDropTargetContainer)||void 0===e?void 0:e.model}}),a.updateDropTargetModel(i),(0,dom_1.toggleClass)(a.gridview.element,"dv-dockview",!0),(0,dom_1.toggleClass)(a.element,"dv-debug",!!i.debug),a.updateTheme(),a.updateWatermark(),i.debug&&a.addDisposables(new strictEventsSequencing_1.StrictEventsSequencing(a)),a.addDisposables(a.rootDropTargetContainer,a.overlayRenderContainer,a._onWillDragPanel,a._onWillDragGroup,a._onWillShowOverlay,a._onDidActivePanelChange,a._onDidAddPanel,a._onDidRemovePanel,a._onDidLayoutFromJSON,a._onDidDrop,a._onWillDrop,a._onDidMovePanel,a._onDidAddGroup,a._onDidRemoveGroup,a._onDidActiveGroupChange,a._onUnhandledDragOverEvent,a._onDidMaximizedGroupChange,a._onDidOptionsChange,a._onDidPopoutGroupSizeChange,a._onDidPopoutGroupPositionChange,a._onDidOpenPopoutWindowFail,a.onDidViewVisibilityChangeMicroTaskQueue((function(){a.updateWatermark()})),a.onDidAdd((function(e){a._moving||a._onDidAddGroup.fire(e)})),a.onDidRemove((function(e){a._moving||a._onDidRemoveGroup.fire(e)})),a.onDidActiveChange((function(e){a._moving||a._onDidActiveGroupChange.fire(e)})),a.onDidMaximizedChange((function(e){a._onDidMaximizedGroupChange.fire({group:e.panel,isMaximized:e.isMaximized})})),events_1.Event.any(a.onDidAdd,a.onDidRemove)((function(){a.updateWatermark()})),events_1.Event.any(a.onDidAddPanel,a.onDidRemovePanel,a.onDidAddGroup,a.onDidRemove,a.onDidMovePanel,a.onDidActivePanelChange,a.onDidPopoutGroupPositionChange,a.onDidPopoutGroupSizeChange)((function(){a._bufferOnDidLayoutChange.fire()})),lifecycle_1.Disposable.from((function(){var e,o,i,t;try{for(var n=__values(__spreadArray([],__read(a._floatingGroups),!1)),r=n.next();!r.done;r=n.next()){r.value.dispose()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}try{for(var p=__values(__spreadArray([],__read(a._popoutGroups),!1)),l=p.next();!l.done;l=p.next()){l.value.disposable.dispose()}}catch(e){i={error:e}}finally{try{l&&!l.done&&(t=p.return)&&t.call(p)}finally{if(i)throw i.error}}})),a._rootDropTarget,a._rootDropTarget.onWillShowOverlay((function(e){a.gridview.length>0&&"center"===e.position||a._onWillShowOverlay.fire(new events_2.WillShowOverlayLocationEvent(e,{kind:"edge",panel:void 0,api:a._api,group:void 0,getData:dataTransfer_1.getPanelData}))})),a._rootDropTarget.onDrop((function(e){var o,i=new dockviewGroupPanelModel_1.DockviewWillDropEvent({nativeEvent:e.nativeEvent,position:e.position,panel:void 0,api:a._api,group:void 0,getData:dataTransfer_1.getPanelData,kind:"edge"});if(a._onWillDrop.fire(i),!i.defaultPrevented){var t=(0,dataTransfer_1.getPanelData)();t?a.moveGroupOrPanel({from:{groupId:t.groupId,panelId:null!==(o=t.panelId)&&void 0!==o?o:void 0},to:{group:a.orthogonalize(e.position),position:"center"}}):a._onDidDrop.fire(new dockviewGroupPanelModel_1.DockviewDidDropEvent({nativeEvent:e.nativeEvent,position:e.position,panel:void 0,api:a._api,group:void 0,getData:dataTransfer_1.getPanelData}))}})),a._rootDropTarget),a}return __extends(o,e),Object.defineProperty(o.prototype,"orientation",{get:function(){return this.gridview.orientation},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"totalPanels",{get:function(){return this.panels.length},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"panels",{get:function(){return this.groups.flatMap((function(e){return e.panels}))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"activePanel",{get:function(){var e=this.activeGroup;if(e)return e.activePanel},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"renderer",{get:function(){var e;return null!==(e=this.options.defaultRenderer)&&void 0!==e?e:"onlyWhenVisible"},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"api",{get:function(){return this._api},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"floatingGroups",{get:function(){return this._floatingGroups},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"popoutRestorationPromise",{get:function(){return this._popoutRestorationPromise},enumerable:!1,configurable:!0}),o.prototype.setVisible=function(o,i){switch(o.api.location.type){case"grid":e.prototype.setVisible.call(this,o,i);break;case"floating":var t=this.floatingGroups.find((function(e){return e.group===o}));t&&(t.overlay.setVisible(i),o.api._onDidVisibilityChange.fire({isVisible:i}));break;case"popout":console.warn("dockview: You cannot hide a group that is in a popout window")}},o.prototype.addPopoutGroup=function(e,o){var i,t,n,r,a,p=this;if(e instanceof dockviewPanel_1.DockviewPanel&&1===e.group.size)return this.addPopoutGroup(e.group,o);var l=(0,dom_1.getDockviewTheme)(this.gridview.element),d=this.element;var s=(null==o?void 0:o.position)?o.position:e instanceof dockviewGroupPanel_1.DockviewGroupPanel?e.element.getBoundingClientRect():e.group?e.group.element.getBoundingClientRect():d.getBoundingClientRect(),u=null!==(t=null===(i=null==o?void 0:o.overridePopoutGroup)||void 0===i?void 0:i.id)&&void 0!==t?t:this.getNextGroupId(),v=new popoutWindow_1.PopoutWindow("".concat(this.id,"-").concat(u),null!=l?l:"",{url:null!==(a=null!==(n=null==o?void 0:o.popoutUrl)&&void 0!==n?n:null===(r=this.options)||void 0===r?void 0:r.popoutUrl)&&void 0!==a?a:"/popout.html",left:window.screenX+s.left,top:window.screenY+s.top,width:s.width,height:s.height,onDidOpen:null==o?void 0:o.onDidOpen,onWillClose:null==o?void 0:o.onWillClose}),c=new lifecycle_1.CompositeDisposable(v,v.onDidClose((function(){c.dispose()})));return v.open().then((function(i){var t;if(v.isDisposed)return!1;var n,r=(null==o?void 0:o.referenceGroup)?o.referenceGroup:e instanceof dockviewPanel_1.DockviewPanel?e.group:e,a=e.api.location.type,l=null!==r.element.parentElement;if(l?(null==o?void 0:o.overridePopoutGroup)?n=o.overridePopoutGroup:(n=p.createGroup({id:u}),i&&p._onDidAddGroup.fire(n)):n=r,null===i)return console.error("dockview: failed to create popout. perhaps you need to allow pop-ups for this website"),c.dispose(),p._onDidOpenPopoutWindowFail.fire(),p.movingLock((function(){return moveGroupWithoutDestroying({from:n,to:r})})),r.api.isVisible||r.api.setVisible(!0),!1;var d=document.createElement("div");d.className="dv-overlay-render-container";var s,h=new overlayRenderContainer_1.OverlayRenderContainer(d,p);if(n.model.renderContainer=h,n.layout(v.window.innerWidth,v.window.innerHeight),!(null==o?void 0:o.overridePopoutGroup)&&l)if(e instanceof dockviewPanel_1.DockviewPanel)p.movingLock((function(){var o=r.model.removePanel(e);n.model.openPanel(o)}));else switch(p.movingLock((function(){return moveGroupWithoutDestroying({from:r,to:n})})),a){case"grid":r.api.setVisible(!1);break;case"floating":case"popout":s=null===(t=p._floatingGroups.find((function(o){return o.group.api.id===e.api.id})))||void 0===t?void 0:t.overlay.toJSON(),p.removeGroup(r)}i.classList.add("dv-dockview"),i.style.overflow="hidden",i.appendChild(d),i.appendChild(n.element);var f,g=document.createElement("div"),_=new dropTargetAnchorContainer_1.DropTargetAnchorContainer(g,{disabled:p.rootDropTargetContainer.disabled});i.appendChild(g),n.model.dropTargetContainer=_,n.model.location={type:"popout",getWindow:function(){return v.window},popoutUrl:null==o?void 0:o.popoutUrl},l&&"grid"===e.api.location.type&&e.api.setVisible(!1),p.doSetGroupAndPanelActive(n),c.addDisposables(n.api.onDidActiveChange((function(e){var o;e.isActive&&(null===(o=v.window)||void 0===o||o.focus())})),n.api.onWillFocus((function(){var e;null===(e=v.window)||void 0===e||e.focus()})));var m=l&&r&&p.getPanel(r.id),w={window:v,popoutGroup:n,referenceGroup:m?r.id:void 0,disposable:{dispose:function(){return c.dispose(),f}}},G=(0,dom_1.onDidWindowMoveEnd)(v.window);return c.addDisposables(G,(0,dom_1.onDidWindowResizeEnd)(v.window,(function(){p._onDidPopoutGroupSizeChange.fire({width:v.window.innerWidth,height:v.window.innerHeight,group:n})})),G.event((function(){p._onDidPopoutGroupPositionChange.fire({screenX:v.window.screenX,screenY:v.window.screenX,group:n})})),(0,events_1.addDisposableListener)(v.window,"resize",(function(){n.layout(v.window.innerWidth,v.window.innerHeight)})),h,lifecycle_1.Disposable.from((function(){if(!p.isDisposed)if(l&&p.getPanel(r.id))p.movingLock((function(){return moveGroupWithoutDestroying({from:n,to:r})})),r.api.isVisible||r.api.setVisible(!0),p.getPanel(n.id)&&p.doRemoveGroup(n,{skipPopoutAssociated:!0});else if(p.getPanel(n.id)){if(n.model.renderContainer=p.overlayRenderContainer,n.model.dropTargetContainer=p.rootDropTargetContainer,f=n,!p._popoutGroups.find((function(e){return e.popoutGroup===n})))return;s?p.addFloatingGroup(n,{height:s.height,width:s.width,position:s}):(p.doRemoveGroup(n,{skipDispose:!0,skipActive:!0,skipPopoutReturn:!0}),n.model.location={type:"grid"},p.movingLock((function(){p.doAddGroup(n,[0])}))),p.doSetGroupAndPanelActive(n)}}))),p._popoutGroups.push(w),p.updateWatermark(),!0})).catch((function(e){return console.error("dockview: failed to create popout.",e),!1}))},o.prototype.addFloatingGroup=function(e,o){var i,t,n,r,a,p,l=this;if(e instanceof dockviewPanel_1.DockviewPanel)p=this.createGroup(),this._onDidAddGroup.fire(p),this.movingLock((function(){return l.removePanel(e,{removeEmptyGroup:!0,skipDispose:!0,skipSetActiveGroup:!0})})),this.movingLock((function(){return p.model.openPanel(e,{skipSetGroupActive:!0})}));else{p=e;var d=null===(i=this._popoutGroups.find((function(e){return e.popoutGroup===p})))||void 0===i?void 0:i.referenceGroup,s=d?this.getPanel(d):void 0;"boolean"==typeof(null==o?void 0:o.skipRemoveGroup)&&o.skipRemoveGroup||(s?(this.movingLock((function(){return moveGroupWithoutDestroying({from:e,to:s})})),this.doRemoveGroup(e,{skipPopoutReturn:!0,skipPopoutAssociated:!0}),this.doRemoveGroup(s,{skipDispose:!0}),p=s):this.doRemoveGroup(e,{skipDispose:!0,skipPopoutReturn:!0,skipPopoutAssociated:!1}))}var u=function(){if(null==o?void 0:o.position){var e={};return"left"in o.position?e.left=Math.max(o.position.left,0):"right"in o.position?e.right=Math.max(o.position.right,0):e.left=constants_1.DEFAULT_FLOATING_GROUP_POSITION.left,"top"in o.position?e.top=Math.max(o.position.top,0):"bottom"in o.position?e.bottom=Math.max(o.position.bottom,0):e.top=constants_1.DEFAULT_FLOATING_GROUP_POSITION.top,"number"==typeof o.width?e.width=Math.max(o.width,0):e.width=constants_1.DEFAULT_FLOATING_GROUP_POSITION.width,"number"==typeof o.height?e.height=Math.max(o.height,0):e.height=constants_1.DEFAULT_FLOATING_GROUP_POSITION.height,e}return{left:"number"==typeof(null==o?void 0:o.x)?Math.max(o.x,0):constants_1.DEFAULT_FLOATING_GROUP_POSITION.left,top:"number"==typeof(null==o?void 0:o.y)?Math.max(o.y,0):constants_1.DEFAULT_FLOATING_GROUP_POSITION.top,width:"number"==typeof(null==o?void 0:o.width)?Math.max(o.width,0):constants_1.DEFAULT_FLOATING_GROUP_POSITION.width,height:"number"==typeof(null==o?void 0:o.height)?Math.max(o.height,0):constants_1.DEFAULT_FLOATING_GROUP_POSITION.height}}(),v=new overlay_1.Overlay(__assign(__assign({container:this.gridview.element,content:p.element},u),{minimumInViewportWidth:"boundedWithinViewport"===this.options.floatingGroupBounds?void 0:null!==(n=null===(t=this.options.floatingGroupBounds)||void 0===t?void 0:t.minimumWidthWithinViewport)&&void 0!==n?n:constants_1.DEFAULT_FLOATING_GROUP_OVERFLOW_SIZE,minimumInViewportHeight:"boundedWithinViewport"===this.options.floatingGroupBounds?void 0:null!==(a=null===(r=this.options.floatingGroupBounds)||void 0===r?void 0:r.minimumHeightWithinViewport)&&void 0!==a?a:constants_1.DEFAULT_FLOATING_GROUP_OVERFLOW_SIZE})),c=p.element.querySelector(".dv-void-container");if(!c)throw new Error("failed to find drag handle");v.setupDrag(c,{inDragMode:"boolean"==typeof(null==o?void 0:o.inDragMode)&&o.inDragMode});var h=new dockviewFloatingGroupPanel_1.DockviewFloatingGroupPanel(p,v),f=new lifecycle_1.CompositeDisposable(p.api.onDidActiveChange((function(e){e.isActive&&v.bringToFront()})),(0,dom_1.watchElementResize)(p.element,(function(e){var o=e.contentRect,i=o.width,t=o.height;p.layout(i,t)})));h.addDisposables(v.onDidChange((function(){p.layout(p.width,p.height)})),v.onDidChangeEnd((function(){l._bufferOnDidLayoutChange.fire()})),p.onDidChange((function(e){v.setBounds({height:null==e?void 0:e.height,width:null==e?void 0:e.width})})),{dispose:function(){f.dispose(),(0,array_1.remove)(l._floatingGroups,h),p.model.location={type:"grid"},l.updateWatermark()}}),this._floatingGroups.push(h),p.model.location={type:"floating"},(null==o?void 0:o.skipActiveGroup)||this.doSetGroupAndPanelActive(p),this.updateWatermark()},o.prototype.orthogonalize=function(e,o){switch(this.gridview.normalize(),e){case"top":case"bottom":this.gridview.orientation===splitview_1.Orientation.HORIZONTAL&&this.gridview.insertOrthogonalSplitviewAtRoot();break;case"left":case"right":this.gridview.orientation===splitview_1.Orientation.VERTICAL&&this.gridview.insertOrthogonalSplitviewAtRoot()}switch(e){case"top":case"left":case"center":return this.createGroupAtLocation([0],void 0,o);case"bottom":case"right":return this.createGroupAtLocation([this.gridview.length],void 0,o);default:throw new Error("unsupported position ".concat(e))}},o.prototype.updateOptions=function(o){var i,t,n,r;if(e.prototype.updateOptions.call(this,o),"floatingGroupBounds"in o)try{for(var a=__values(this._floatingGroups),p=a.next();!p.done;p=a.next()){var l=p.value;switch(o.floatingGroupBounds){case"boundedWithinViewport":l.overlay.minimumInViewportHeight=void 0,l.overlay.minimumInViewportWidth=void 0;break;case void 0:l.overlay.minimumInViewportHeight=constants_1.DEFAULT_FLOATING_GROUP_OVERFLOW_SIZE,l.overlay.minimumInViewportWidth=constants_1.DEFAULT_FLOATING_GROUP_OVERFLOW_SIZE;break;default:l.overlay.minimumInViewportHeight=null===(n=o.floatingGroupBounds)||void 0===n?void 0:n.minimumHeightWithinViewport,l.overlay.minimumInViewportWidth=null===(r=o.floatingGroupBounds)||void 0===r?void 0:r.minimumWidthWithinViewport}l.overlay.setBounds()}}catch(e){i={error:e}}finally{try{p&&!p.done&&(t=a.return)&&t.call(a)}finally{if(i)throw i.error}}this.updateDropTargetModel(o);var d=this.options.disableDnd;this._options=__assign(__assign({},this.options),o),d!==this.options.disableDnd&&this.updateDragAndDropState(),"theme"in o&&this.updateTheme(),this.layout(this.gridview.width,this.gridview.height,!0)},o.prototype.layout=function(o,i,t){var n,r;if(e.prototype.layout.call(this,o,i,t),this._floatingGroups)try{for(var a=__values(this._floatingGroups),p=a.next();!p.done;p=a.next()){p.value.overlay.setBounds()}}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},o.prototype.updateDragAndDropState=function(){var e,o;try{for(var i=__values(this.groups),t=i.next();!t.done;t=i.next()){t.value.model.updateDragAndDropState()}}catch(o){e={error:o}}finally{try{t&&!t.done&&(o=i.return)&&o.call(i)}finally{if(e)throw e.error}}},o.prototype.focus=function(){var e;null===(e=this.activeGroup)||void 0===e||e.focus()},o.prototype.getGroupPanel=function(e){return this.panels.find((function(o){return o.id===e}))},o.prototype.setActivePanel=function(e){e.group.model.openPanel(e),this.doSetGroupAndPanelActive(e.group)},o.prototype.moveToNext=function(e){var o;if(void 0===e&&(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[e.group.panels.length-1])e.group.model.moveToNext({suppressRoll:!0});else{var i=(0,gridview_1.getGridLocation)(e.group.element),t=null===(o=this.gridview.next(i))||void 0===o?void 0:o.view;this.doSetGroupAndPanelActive(t)}},o.prototype.moveToPrevious=function(e){var o;if(void 0===e&&(e={}),!e.group){if(!this.activeGroup)return;e.group=this.activeGroup}if(e.includePanel&&e.group&&e.group.activePanel!==e.group.panels[0])e.group.model.moveToPrevious({suppressRoll:!0});else{var i=(0,gridview_1.getGridLocation)(e.group.element),t=null===(o=this.gridview.previous(i))||void 0===o?void 0:o.view;t&&this.doSetGroupAndPanelActive(t)}},o.prototype.toJSON=function(){var e,o=this.gridview.serialize(),i=this.panels.reduce((function(e,o){return e[o.id]=o.toJSON(),e}),{}),t=this._floatingGroups.map((function(e){return{data:e.group.toJSON(),position:e.overlay.toJSON()}})),n=this._popoutGroups.map((function(e){return{data:e.popoutGroup.toJSON(),gridReferenceGroup:e.referenceGroup,position:e.window.dimensions(),url:"popout"===e.popoutGroup.api.location.type?e.popoutGroup.api.location.popoutUrl:void 0}})),r={grid:o,panels:i,activeGroup:null===(e=this.activeGroup)||void 0===e?void 0:e.id};return t.length>0&&(r.floatingGroups=t),n.length>0&&(r.popoutGroups=n),r},o.prototype.fromJSON=function(e){var o,i,t,n,r,a,p,l,d,s,u,v,c,h,f=this;if(this.clear(),"object"!=typeof e||null===e)throw new Error("serialized layout must be a non-null object");var g=e.grid,_=e.panels,m=e.activeGroup;if("branch"!==g.root.type||!Array.isArray(g.root.data))throw new Error("root must be of type branch");try{var w=this.width,G=this.height,y=function(e){var o,i,t=e.id,n=e.locked,r=e.hideHeader,a=e.views,p=e.activeView;if("string"!=typeof t)throw new Error("group id must be of type string");var l=f.createGroup({id:t,locked:!!n,hideHeader:!!r});f._onDidAddGroup.fire(l);var d=[];try{for(var s=__values(a),u=s.next();!u.done;u=s.next()){var v=u.value,c=f._deserializer.fromJSON(_[v],l);d.push(c)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}for(var h=0;h<a.length;h++){c=d[h];var g="string"==typeof p&&p===c.id;l.model.openPanel(c,{skipSetActive:!g,skipSetGroupActive:!0})}return!l.activePanel&&l.panels.length>0&&l.model.openPanel(l.panels[l.panels.length-1],{skipSetGroupActive:!0}),l};this.gridview.deserialize(g,{fromJSON:function(e){return y(e.data)}}),this.layout(w,G,!0);var D=null!==(c=e.floatingGroups)&&void 0!==c?c:[];try{for(var P=__values(D),A=P.next();!A.done;A=P.next()){var k=A.value,O=k.data,S=k.position,b=y(O);this.addFloatingGroup(b,{position:S,width:S.width,height:S.height,skipRemoveGroup:!0,inDragMode:!1})}}catch(e){o={error:e}}finally{try{A&&!A.done&&(i=P.return)&&i.call(P)}finally{if(o)throw o.error}}var C=null!==(h=e.popoutGroups)&&void 0!==h?h:[],E=[];C.forEach((function(e,o){var i=e.data,t=e.position,n=e.gridReferenceGroup,r=e.url,a=y(i),p=new Promise((function(e){setTimeout((function(){f.addPopoutGroup(a,{position:null!=t?t:void 0,overridePopoutGroup:n?a:void 0,referenceGroup:n?f.getPanel(n):void 0,popoutUrl:r}),e()}),o*constants_1.DESERIALIZATION_POPOUT_DELAY_MS)}));E.push(p)})),this._popoutRestorationPromise=Promise.all(E).then((function(){}));try{for(var T=__values(this._floatingGroups),R=T.next();!R.done;R=T.next()){R.value.overlay.setBounds()}}catch(e){t={error:e}}finally{try{R&&!R.done&&(n=T.return)&&n.call(T)}finally{if(t)throw t.error}}if("string"==typeof m)(M=this.getPanel(m))&&this.doSetGroupAndPanelActive(M)}catch(e){console.error("dockview: failed to deserialize layout. Reverting changes",e);try{for(var L=__values(this.groups),x=L.next();!x.done;x=L.next()){b=x.value;try{for(var W=(p=void 0,__values(b.panels)),I=W.next();!I.done;I=W.next()){var M=I.value;this.removePanel(M,{removeEmptyGroup:!1,skipDispose:!1})}}catch(e){p={error:e}}finally{try{I&&!I.done&&(l=W.return)&&l.call(W)}finally{if(p)throw p.error}}}}catch(e){r={error:e}}finally{try{x&&!x.done&&(a=L.return)&&a.call(L)}finally{if(r)throw r.error}}try{for(var F=__values(this.groups),N=F.next();!N.done;N=F.next()){(b=N.value).dispose(),this._groups.delete(b.id),this._onDidRemoveGroup.fire(b)}}catch(e){d={error:e}}finally{try{N&&!N.done&&(s=F.return)&&s.call(F)}finally{if(d)throw d.error}}try{for(var z=__values(__spreadArray([],__read(this._floatingGroups),!1)),V=z.next();!V.done;V=z.next()){V.value.dispose()}}catch(e){u={error:e}}finally{try{V&&!V.done&&(v=z.return)&&v.call(z)}finally{if(u)throw u.error}}throw this.clear(),e}this.updateWatermark(),requestAnimationFrame((function(){f.overlayRenderContainer.updateAllPositions()})),this._onDidLayoutFromJSON.fire()},o.prototype.clear=function(){var e,o,i=Array.from(this._groups.values()).map((function(e){return e.value})),t=!!this.activeGroup;try{for(var n=__values(i),r=n.next();!r.done;r=n.next()){var a=r.value;this.removeGroup(a,{skipActive:!0})}}catch(o){e={error:o}}finally{try{r&&!r.done&&(o=n.return)&&o.call(n)}finally{if(e)throw e.error}}t&&this.doSetGroupAndPanelActive(void 0),this.gridview.clear()},o.prototype.closeAllGroups=function(){var e,o;try{for(var i=__values(this._groups.entries()),t=i.next();!t.done;t=i.next()){var n=t.value,r=__read(n,2);r[0];r[1].value.model.closeAllPanels()}}catch(o){e={error:o}}finally{try{t&&!t.done&&(o=i.return)&&o.call(i)}finally{if(e)throw e.error}}},o.prototype.addPanel=function(e){var o,i,t;if(this.panels.find((function(o){return o.id===e.id})))throw new Error("panel with id ".concat(e.id," already exists"));if(e.position&&e.floating)throw new Error("you can only provide one of: position, floating as arguments to .addPanel(...)");var n,r,a={width:e.initialWidth,height:e.initialHeight};if(e.position)if((0,options_1.isPanelOptionsWithPanel)(e.position)){var p="string"==typeof e.position.referencePanel?this.getGroupPanel(e.position.referencePanel):e.position.referencePanel;if(n=e.position.index,!p)throw new Error("referencePanel '".concat(e.position.referencePanel,"' does not exist"));t=this.findGroup(p)}else{if(!(0,options_1.isPanelOptionsWithGroup)(e.position)){var l=this.orthogonalize((0,droptarget_1.directionToPosition)(e.position.direction)),d=this.createPanel(e,l);return l.model.openPanel(d,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n}),e.inactive||this.doSetGroupAndPanelActive(l),l.api.setSize({height:null==a?void 0:a.height,width:null==a?void 0:a.width}),d}if(t="string"==typeof e.position.referenceGroup?null===(o=this._groups.get(e.position.referenceGroup))||void 0===o?void 0:o.value:e.position.referenceGroup,n=e.position.index,!t)throw new Error("referenceGroup '".concat(e.position.referenceGroup,"' does not exist"))}else t=this.activeGroup;if(t){var s=(0,baseComponentGridview_1.toTarget)((null===(i=e.position)||void 0===i?void 0:i.direction)||"within");if(e.floating){l=this.createGroup();this._onDidAddGroup.fire(l);var u="object"==typeof e.floating&&null!==e.floating?e.floating:{};this.addFloatingGroup(l,__assign(__assign({},u),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),r=this.createPanel(e,l),l.model.openPanel(r,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n})}else if("floating"===t.api.location.type||"center"===s)r=this.createPanel(e,t),t.model.openPanel(r,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n}),t.api.setSize({width:null==a?void 0:a.width,height:null==a?void 0:a.height}),e.inactive||this.doSetGroupAndPanelActive(t);else{var v=(0,gridview_1.getGridLocation)(t.element),c=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,v,s);l=this.createGroupAtLocation(c,this.orientationAtLocation(c)===splitview_1.Orientation.VERTICAL?null==a?void 0:a.height:null==a?void 0:a.width);r=this.createPanel(e,l),l.model.openPanel(r,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n}),e.inactive||this.doSetGroupAndPanelActive(l)}}else if(e.floating){l=this.createGroup();this._onDidAddGroup.fire(l);var h="object"==typeof e.floating&&null!==e.floating?e.floating:{};this.addFloatingGroup(l,__assign(__assign({},h),{inDragMode:!1,skipRemoveGroup:!0,skipActiveGroup:!0})),r=this.createPanel(e,l),l.model.openPanel(r,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n})}else{l=this.createGroupAtLocation([0],this.gridview.orientation===splitview_1.Orientation.VERTICAL?null==a?void 0:a.height:null==a?void 0:a.width);r=this.createPanel(e,l),l.model.openPanel(r,{skipSetActive:e.inactive,skipSetGroupActive:e.inactive,index:n}),e.inactive||this.doSetGroupAndPanelActive(l)}return r},o.prototype.removePanel=function(e,o){void 0===o&&(o={removeEmptyGroup:!0});var i=e.group;if(!i)throw new Error("cannot remove panel ".concat(e.id,". it's missing a group."));i.model.removePanel(e,{skipSetActiveGroup:o.skipSetActiveGroup}),o.skipDispose||(e.group.model.renderContainer.detatch(e),e.dispose()),0===i.size&&o.removeEmptyGroup&&this.removeGroup(i,{skipActive:o.skipSetActiveGroup})},o.prototype.createWatermarkComponent=function(){return this.options.createWatermarkComponent?this.options.createWatermarkComponent():new watermark_1.Watermark},o.prototype.updateWatermark=function(){var e,o;if(0===this.groups.filter((function(e){return"grid"===e.api.location.type&&e.api.isVisible})).length){if(!this._watermark){this._watermark=this.createWatermarkComponent(),this._watermark.init({containerApi:new component_api_1.DockviewApi(this)});var i=document.createElement("div");i.className="dv-watermark-container",(0,dom_1.addTestId)(i,"watermark-component"),i.appendChild(this._watermark.element),this.gridview.element.appendChild(i)}}else this._watermark&&(this._watermark.element.parentElement.remove(),null===(o=(e=this._watermark).dispose)||void 0===o||o.call(e),this._watermark=null)},o.prototype.addGroup=function(e){var o;if(e){var i=void 0;if((0,options_1.isGroupOptionsWithPanel)(e)){var t="string"==typeof e.referencePanel?this.panels.find((function(o){return o.id===e.referencePanel})):e.referencePanel;if(!t)throw new Error("reference panel ".concat(e.referencePanel," does not exist"));if(!(i=this.findGroup(t)))throw new Error("reference group for reference panel ".concat(e.referencePanel," does not exist"))}else{if(!(0,options_1.isGroupOptionsWithGroup)(e)){var n=this.orthogonalize((0,droptarget_1.directionToPosition)(e.direction),e);return e.skipSetActive||this.doSetGroupAndPanelActive(n),n}if(!(i="string"==typeof e.referenceGroup?null===(o=this._groups.get(e.referenceGroup))||void 0===o?void 0:o.value:e.referenceGroup))throw new Error("reference group ".concat(e.referenceGroup," does not exist"))}var r=(0,baseComponentGridview_1.toTarget)(e.direction||"within"),a=(0,gridview_1.getGridLocation)(i.element),p=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,a,r),l=this.createGroup(e),d=this.getLocationOrientation(p)===splitview_1.Orientation.VERTICAL?e.initialHeight:e.initialWidth;return this.doAddGroup(l,p,d),e.skipSetActive||this.doSetGroupAndPanelActive(l),l}l=this.createGroup(e);return this.doAddGroup(l),this.doSetGroupAndPanelActive(l),l},o.prototype.getLocationOrientation=function(e){return e.length%2==0&&this.gridview.orientation===splitview_1.Orientation.HORIZONTAL?splitview_1.Orientation.HORIZONTAL:splitview_1.Orientation.VERTICAL},o.prototype.removeGroup=function(e,o){this.doRemoveGroup(e,o)},o.prototype.doRemoveGroup=function(o,i){var t,n,r,a=__spreadArray([],__read(o.panels),!1);if(!(null==i?void 0:i.skipDispose))try{for(var p=__values(a),l=p.next();!l.done;l=p.next()){var d=l.value;this.removePanel(d,{removeEmptyGroup:!1,skipDispose:null!==(r=null==i?void 0:i.skipDispose)&&void 0!==r&&r})}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}var s=this.activePanel;if("floating"===o.api.location.type){var u=this._floatingGroups.find((function(e){return e.group===o}));if(u){if((null==i?void 0:i.skipDispose)||(u.group.dispose(),this._groups.delete(o.id),this._onDidRemoveGroup.fire(o)),(0,array_1.remove)(this._floatingGroups,u),u.dispose(),!(null==i?void 0:i.skipActive)&&this._activeGroup===o){var v=Array.from(this._groups.values());this.doSetGroupAndPanelActive(v.length>0?v[0].value:void 0)}return u.group}throw new Error("failed to find floating group")}if("popout"===o.api.location.type){var c=this._popoutGroups.find((function(e){return e.popoutGroup===o}));if(c){if(!(null==i?void 0:i.skipDispose)){if(!(null==i?void 0:i.skipPopoutAssociated)){var h=c.referenceGroup?this.getPanel(c.referenceGroup):void 0;h&&0===h.panels.length&&this.removeGroup(h)}c.popoutGroup.dispose(),this._groups.delete(o.id),this._onDidRemoveGroup.fire(o)}(0,array_1.remove)(this._popoutGroups,c);var f=c.disposable.dispose();if(!(null==i?void 0:i.skipPopoutReturn)&&f&&(this.doAddGroup(f,[0]),this.doSetGroupAndPanelActive(f)),!(null==i?void 0:i.skipActive)&&this._activeGroup===o){v=Array.from(this._groups.values());this.doSetGroupAndPanelActive(v.length>0?v[0].value:void 0)}return this.updateWatermark(),c.popoutGroup}throw new Error("failed to find popout group")}var g=e.prototype.doRemoveGroup.call(this,o,i);return(null==i?void 0:i.skipActive)||this.activePanel!==s&&this._onDidActivePanelChange.fire(this.activePanel),g},o.prototype.movingLock=function(e){var o=this._moving;try{return this._moving=!0,e()}finally{this._moving=o}},o.prototype.moveGroupOrPanel=function(e){var o,i=this,t=e.to.group,n=e.from.groupId,r=e.from.panelId,a=e.to.position,p=e.to.index,l=n?null===(o=this._groups.get(n))||void 0===o?void 0:o.value:void 0;if(!l)throw new Error("Failed to find group id ".concat(n));if(void 0!==r)if(a&&"center"!==a){var d=(0,gridview_1.getGridLocation)(t.element),s=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,d,a);if(l.size<2){var u=__read((0,array_1.tail)(s),2),v=u[0],c=u[1];if("grid"===l.api.location.type){var h=(0,gridview_1.getGridLocation)(l.element),f=__read((0,array_1.tail)(h),2),g=f[0],_=f[1];if((0,array_1.sequenceEquals)(g,v))return this.gridview.moveView(g,_,c),void this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:l})}if("popout"===l.api.location.type){var m=this._popoutGroups.find((function(e){return e.popoutGroup===l})),w=this.movingLock((function(){return m.popoutGroup.model.removePanel(m.popoutGroup.panels[0],{skipSetActive:!0,skipSetActiveGroup:!0})}));this.doRemoveGroup(l,{skipActive:!0});var G=this.createGroupAtLocation(s);return this.movingLock((function(){return G.model.openPanel(w)})),this.doSetGroupAndPanelActive(G),void this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:l})}var y=this.movingLock((function(){return i.doRemoveGroup(l,{skipActive:!0,skipDispose:!0})})),D=(0,gridview_1.getGridLocation)(t.element),P=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,D,a);this.movingLock((function(){return i.doAddGroup(y,P)})),this.doSetGroupAndPanelActive(y),this._onDidMovePanel.fire({panel:this.getGroupPanel(r),from:l})}else{var A=this.movingLock((function(){return l.model.removePanel(r,{skipSetActive:!1,skipSetActiveGroup:!0})}));if(!A)throw new Error("No panel with id ".concat(r));var k=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,d,a),O=this.createGroupAtLocation(k);this.movingLock((function(){return O.model.openPanel(A,{skipSetGroupActive:!0})})),this.doSetGroupAndPanelActive(O),this._onDidMovePanel.fire({panel:A,from:l})}}else{var S=this.movingLock((function(){return l.model.removePanel(r,{skipSetActive:!1,skipSetActiveGroup:!0})}));if(!S)throw new Error("No panel with id ".concat(r));0===l.model.size&&this.doRemoveGroup(l,{skipActive:!0});var b=0===t.model.size;this.movingLock((function(){var o;return t.model.openPanel(S,{index:p,skipSetActive:null!==(o=e.skipSetActive)&&void 0!==o&&o&&!b,skipSetGroupActive:!0})})),e.skipSetActive||this.doSetGroupAndPanelActive(t),this._onDidMovePanel.fire({panel:S,from:l})}else this.moveGroup({from:{group:l},to:{group:t,position:a},skipSetActive:e.skipSetActive})},o.prototype.moveGroup=function(e){var o=this,i=e.from.group,t=e.to.group,n=e.to.position;if("center"===n){var r=i.activePanel,a=this.movingLock((function(){return __spreadArray([],__read(i.panels),!1).map((function(e){return i.model.removePanel(e.id,{skipSetActive:!0})}))}));0===(null==i?void 0:i.model.size)&&this.doRemoveGroup(i,{skipActive:!0}),this.movingLock((function(){var e,o;try{for(var i=__values(a),n=i.next();!n.done;n=i.next()){var p=n.value;t.model.openPanel(p,{skipSetActive:p!==r,skipSetGroupActive:!0})}}catch(o){e={error:o}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(e)throw e.error}}})),!0!==e.skipSetActive?this.doSetGroupAndPanelActive(t):this.activePanel||this.doSetGroupAndPanelActive(t)}else{switch(i.api.location.type){case"grid":this.gridview.removeView((0,gridview_1.getGridLocation)(i.element));break;case"floating":var p=this._floatingGroups.find((function(e){return e.group===i}));if(!p)throw new Error("failed to find floating group");p.dispose();break;case"popout":var l=this._popoutGroups.find((function(e){return e.popoutGroup===i}));if(!l)throw new Error("failed to find popout group");var d=this._popoutGroups.indexOf(l);if(d>=0&&this._popoutGroups.splice(d,1),l.referenceGroup){var s=this.getPanel(l.referenceGroup);s&&!s.api.isVisible&&this.doRemoveGroup(s,{skipActive:!0})}l.window.dispose(),"grid"===t.api.location.type?(i.model.renderContainer=this.overlayRenderContainer,i.model.dropTargetContainer=this.rootDropTargetContainer,i.model.location={type:"grid"}):"floating"===t.api.location.type&&(i.model.renderContainer=this.overlayRenderContainer,i.model.dropTargetContainer=this.rootDropTargetContainer,i.model.location={type:"floating"})}if("grid"===t.api.location.type){var u=(0,gridview_1.getGridLocation)(t.element),v=(0,gridview_1.getRelativeLocation)(this.gridview.orientation,u,n),c=void 0;switch(this.gridview.orientation){case splitview_1.Orientation.VERTICAL:c=u.length%2==0?i.api.width:i.api.height;break;case splitview_1.Orientation.HORIZONTAL:c=u.length%2==0?i.api.height:i.api.width}this.gridview.addView(i,c,v)}else if("floating"===t.api.location.type){var h=this._floatingGroups.find((function(e){return e.group===t}));if(h){var f,g=h.overlay.toJSON(),_=void 0;_="left"in g?g.left+50:"right"in g?Math.max(0,g.right-g.width-50):50,f="top"in g?g.top+50:"bottom"in g?Math.max(0,g.bottom-g.height-50):50,this.addFloatingGroup(i,{height:g.height,width:g.width,position:{left:_,top:f}})}}}if(i.panels.forEach((function(e){o._onDidMovePanel.fire({panel:e,from:i})})),!1===e.skipSetActive){var m=null!=t?t:i;this.doSetGroupAndPanelActive(m)}},o.prototype.doSetGroupActive=function(o){e.prototype.doSetGroupActive.call(this,o);var i=this.activePanel;this._moving||i===this._onDidActivePanelChange.value||this._onDidActivePanelChange.fire(i)},o.prototype.doSetGroupAndPanelActive=function(o){e.prototype.doSetGroupActive.call(this,o);var i=this.activePanel;o&&this.hasMaximizedGroup()&&!this.isMaximizedGroup(o)&&this.exitMaximizedGroup(),this._moving||i===this._onDidActivePanelChange.value||this._onDidActivePanelChange.fire(i)},o.prototype.getNextGroupId=function(){for(var e=this.nextGroupId.next();this._groups.has(e);)e=this.nextGroupId.next();return e},o.prototype.createGroup=function(e){var o=this;e||(e={});var i=null==e?void 0:e.id;if(i&&this._groups.has(e.id)&&(console.warn("dockview: Duplicate group id ".concat(null==e?void 0:e.id,". reassigning group id to avoid errors")),i=void 0),!i)for(i=this.nextGroupId.next();this._groups.has(i);)i=this.nextGroupId.next();var t=new dockviewGroupPanel_1.DockviewGroupPanel(this,i,e);if(t.init({params:{},accessor:this}),!this._groups.has(t.id)){var n=new lifecycle_1.CompositeDisposable(t.model.onTabDragStart((function(e){o._onWillDragPanel.fire(e)})),t.model.onGroupDragStart((function(e){o._onWillDragGroup.fire(e)})),t.model.onMove((function(e){var i=e.groupId,n=e.itemId,r=e.target,a=e.index;o.moveGroupOrPanel({from:{groupId:i,panelId:n},to:{group:t,position:r,index:a}})})),t.model.onDidDrop((function(e){o._onDidDrop.fire(e)})),t.model.onWillDrop((function(e){o._onWillDrop.fire(e)})),t.model.onWillShowOverlay((function(e){o.options.disableDnd?e.preventDefault():o._onWillShowOverlay.fire(e)})),t.model.onUnhandledDragOverEvent((function(e){o._onUnhandledDragOverEvent.fire(e)})),t.model.onDidAddPanel((function(e){o._moving||o._onDidAddPanel.fire(e.panel)})),t.model.onDidRemovePanel((function(e){o._moving||o._onDidRemovePanel.fire(e.panel)})),t.model.onDidActivePanelChange((function(e){o._moving||e.panel===o.activePanel&&o._onDidActivePanelChange.value!==e.panel&&o._onDidActivePanelChange.fire(e.panel)})),events_1.Event.any(t.model.onDidPanelTitleChange,t.model.onDidPanelParametersChange)((function(){o._bufferOnDidLayoutChange.fire()})));this._groups.set(t.id,{value:t,disposable:n})}return t.initialize(),t},o.prototype.createPanel=function(e,o){var i,t,n,r=e.component,a=null!==(i=e.tabComponent)&&void 0!==i?i:this.options.defaultTabComponent,p=new dockviewPanelModel_1.DockviewPanelModel(this,e.id,r,a),l=new dockviewPanel_1.DockviewPanel(e.id,r,a,this,this._api,o,p,{renderer:e.renderer,minimumWidth:e.minimumWidth,minimumHeight:e.minimumHeight,maximumWidth:e.maximumWidth,maximumHeight:e.maximumHeight});return l.init({title:null!==(t=e.title)&&void 0!==t?t:e.id,params:null!==(n=null==e?void 0:e.params)&&void 0!==n?n:{}}),l},o.prototype.createGroupAtLocation=function(e,o,i){var t=this.createGroup(i);return this.doAddGroup(t,e,o),t},o.prototype.findGroup=function(e){var o;return null===(o=Array.from(this._groups.values()).find((function(o){return o.value.model.containsPanel(e)})))||void 0===o?void 0:o.value},o.prototype.orientationAtLocation=function(e){var o=this.gridview.orientation;return e.length%2==1?o:(0,gridview_1.orthogonal)(o)},o.prototype.updateDropTargetModel=function(e){"dndEdges"in e&&(this._rootDropTarget.disabled="boolean"==typeof e.dndEdges&&!1===e.dndEdges,"object"==typeof e.dndEdges&&null!==e.dndEdges?this._rootDropTarget.setOverlayModel(e.dndEdges):this._rootDropTarget.setOverlayModel(DEFAULT_ROOT_OVERLAY_MODEL)),"rootOverlayModel"in e&&this.updateDropTargetModel({dndEdges:e.dndEdges})},o.prototype.updateTheme=function(){var e,o,i=null!==(e=this._options.theme)&&void 0!==e?e:theme_1.themeAbyss;if(this._themeClassnames.setClassNames(i.className),this.gridview.margin=null!==(o=i.gap)&&void 0!==o?o:0,"absolute"===i.dndOverlayMounting)this.rootDropTargetContainer.disabled=!1;else this.rootDropTargetContainer.disabled=!0},o}(baseComponentGridview_1.BaseGrid);exports.DockviewComponent=DockviewComponent;
//# sourceMappingURL=/sm/a33c3e4cfc138924bcb3794a7bf014d0e9f454dac479223ce1206807ab8a8c35.map