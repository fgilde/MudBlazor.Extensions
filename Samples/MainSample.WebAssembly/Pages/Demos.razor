@page "/demos/{**Group}"
@inherits BasePage

<MudExCardList TData="object">

    @foreach (var nav in GetFilteredDemos())
    {
        <MudCard Class="index-card" @onclick="@(() => { Open(nav); })">
            <MudCardHeader Style="z-index: 5">
                <CardHeaderContent>
                    @Index.RenderNavEntry(nav, L)
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudIcon Color="@nav.GetIconColor()" Icon="@nav.Icon" />
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent Style="z-index: 5">
                <MudText>@nav.Text</MudText>
                @if (!string.IsNullOrEmpty(nav.Documentation))
                {
                    <MudText Typo="Typo.body2">@L[nav.Documentation]</MudText>
                }
            </MudCardContent>
        </MudCard>
    }
</MudExCardList>

@code
{
    [Parameter] public string? Group { get; set; }

    private IEnumerable<NavigationEntry> GetFilteredDemos()
    {
        var allEntries = DemoAttribute.AllEntries(true);
        
        if (string.IsNullOrEmpty(Group))
            return allEntries;
            
        var decodedGroup = Uri.UnescapeDataString(Group);
        
        // Support ungrouped category
        if (decodedGroup == AppConstants.UngroupedNavCategory)
            return allEntries.Where(n => string.IsNullOrEmpty(n?.Demo?.Group));
            
        // Match exact group or groups starting with this path (hierarchical match)
        return allEntries.Where(n => 
            n?.Demo?.Group == decodedGroup || 
            n?.Demo?.Group?.StartsWith(decodedGroup + "/", StringComparison.OrdinalIgnoreCase) == true);
    }

    private void Open(NavigationEntry nav)
    {
        NavigationManager.NavigateTo(nav.Href);
    }
}