@using Microsoft.Extensions.Localization
@using MudBlazor.Extensions.Core
@using MudBlazor.Extensions.Core.Enums
@inherits LayoutComponentBase
@inject IStringLocalizer<MainLayout> L
<MudThemeProvider @bind-IsDarkMode="@IsDark" Theme="@ClientTheme.CurrentTheme" />
<MudPopoverProvider/>
<MudDialogProvider />
<MudExTaskBar BorderColor="MudExColor.Warning" HideContentWhenCollapsed="true" />
<MudSnackbarProvider />

<MudOverlay @bind-Visible="IsOverlayVisible" DarkBackground="true" AutoClose="true">
    <MudProgressCircular Color="Color.Secondary" Indeterminate="true" />
</MudOverlay>

<MudLayout>

    <MudAppBar Elevation="0">
        @if (!ClientTheme.CurrentTheme.ShowLogoInDrawer)
        {
            <LogoTitle Animate="true"/>
        }

        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
            
        @if (ClientTheme.CurrentTheme.ShowLogoInDrawer)
        {
            <LogoTitle Hidden="@_drawerOpen" />
        }


        <MudSpacer />
        
        <MudExIconButton ToolTip="@L["Try MudEx online"]" Target="_blank" Link="@AppConstants.Urls.GetTryOnline(IsDark)" Icon="@Icons.Material.Rounded.PlayArrow" Color="@(IsDark? Color.Success: Color.Inherit)" />

        <MudExDivider Size="2" Vertical="true" />
        
        <LanguageSelector/>
        
        <MudExDivider Size="2" Vertical="true" />

        <MudTooltip Text="Change or edit theme" Arrow="true" Placement="Placement.Bottom">
            <ThemeEdit OnThemeChanged="@HandleThemeChange" @bind-IsDark="@IsDark" @bind-IsBusy="@IsOverlayVisible" />
        </MudTooltip>

        @* <MudExDivider Size="2" Vertical="true" /> *@
        
        <MudMenu Dense="true" AnchorOrigin="Origin.BottomRight" Icon="@Icons.Material.Filled.MoreVert">
            @if (!_commentsAvailable)
            {
                <MudMenuItem Icon="@Icons.Material.Filled.Comment" OnClick="@(() => _commentsAvailable = true)">@L["Activate comments"]</MudMenuItem>
                <MudExDivider Color="Color.Primary"/>
            }

            <MudMenuItem Target="_blank" Href="@AppConstants.Urls.GetTryOnline(IsDark)" Icon="@Icons.Material.Rounded.PlayArrow" Color="@(IsDark ? Color.Success : Color.Inherit)">@L["Try MudEx online"]</MudMenuItem>
            <MudExDivider Color="Color.Primary"/>
            <MudMenuItem Icon="@Icons.Custom.Brands.MudBlazor" Href="https://www.mudblazor.com" Target="_blank">@L["Official MudBlazor website"]</MudMenuItem>
            <MudMenuItem Icon="@Icons.Custom.Brands.Microsoft" Href="https://www.nuget.org/packages/MudBlazor.Extensions" Target="_blank">Nuget</MudMenuItem>
            <MudMenuItem Icon="@Icons.Custom.Brands.GitHub" Href="https://github.com/fgilde/MudBlazor.Extensions" Target="_blank">GitHub</MudMenuItem>
            <MudExDivider Color="Color.Primary"/>
            <MudMenuItem Icon="@Icons.Material.Outlined.Help" Href="https://fgilde.github.io/MudBlazor.Extensions/" Target="_blank">@L["Documentation"]</MudMenuItem>
            <MudMenuItem Icon="@Icons.Material.Outlined.Info" OnClick="ShowAbout">@L["Info"]</MudMenuItem>
        </MudMenu>

    </MudAppBar>
    <MudDrawer @bind-Open="_drawerOpen" Elevation="1" ClipMode="@ClientTheme.CurrentTheme.DrawerClipMode" Variant="@ClientTheme.CurrentTheme.DrawerVariant">
        @if (ClientTheme.CurrentTheme.ShowLogoInDrawer)
        {
            <MudDrawerHeader>
                <LogoTitle />
            </MudDrawerHeader>
        }
        <NavMenu ViewMode="@(ClientTheme.CurrentTheme?.NavigationViewMode ?? TreeViewMode.Default)" ExpandBehaviour="ClientTheme.CurrentTheme.NavigationExpandMode" />
    </MudDrawer>

    <MudMainContent>
        <MudContainer Style="max-height: 100vh" 
                      MaxWidth="@ClientTheme.CurrentTheme.ContentMaxWidth" 
                      Class="my-sample-main-content-container my-4 pt-4">
            <div style="margin-top: -43px;margin-left: -44px;">
                <NavMenu ViewMode="TreeViewMode.Breadcrumb"/>
            </div>
            @Body
        </MudContainer>
    </MudMainContent>
    

    <CommentsFooter AlwaysClose="@ClientTheme.CurrentTheme.FloatingCommentsButton" 
                    SimpleMode="@ClientTheme.CurrentTheme.FloatingCommentsButton" @bind-Available="_commentsAvailable" />

</MudLayout>
